<!DOCTYPE html>
<html>
<head>
    <title>Game Lobby</title>
</head>

<script src="/socket.io/socket.io.js"></script>
<script>
    var socket = io();
    //Function for setting the username
    function setUsername() {
        //Takes the username submitted from textbox
        socket.emit('setUsername', document.getElementById('name').value);
    };

    var user;
    //if user exists, try another
    socket.on('userExists', function (data) {
        document.getElementById('error-container').innerHTML = data;
    });
    //if not, user is set
    socket.on('userSet', function (data) {
        user = data.username;
        //take user to main lobby page
        lobbyPage();
    });
    //The main lobby page, displaying a text box for joining a lobby, and the Join Lobby and Create Lobby buttons
    function lobbyPage() {
        document.body.innerHTML = '<input type = "text" id = "message">\
         <button type = "button" name = "button" onclick = "joinLobby()">Join Lobby</button><button type="button" name="button1" onclick= "createLobby()">Create Lobby</button>\
         <div id = "message-container"></div>';

    }
    

    //For sending a message in lobby chat
    function sendMessage() {
        
        var newMessage = document.getElementById('message').value;
        //lobby id is stored in the message button name
        var lobbyFrom = document.getElementById('messageBtn').name;
        if (newMessage) {
            socket.emit('newMessage', { message: newMessage, user: user, lobbyFrom: lobbyFrom });
        }
        //reset text box to blank
        document.getElementById('message').value = ''
    }
    //When a new message is received
    socket.on('receiveMessage', function (data) {
       
        if (user) {
            //Add to message container div
            document.getElementById('message-container').innerHTML += '<div><b>' +
                data.user + '</b>: ' + data.message + '</div>'
        }
    });

    //Basic function for creating lobby
    function createLobby() {
        
        
        
        socket.emit('createLobby', { lobbyOwner: user });
        
        

        

    }
    //For connecting to room. 
    //@params data: The lobby id
    socket.on('connectToRoom', function (data) {
        document.title = "Lobby " + data;
        document.body.innerHTML = '<h1>You are in Lobby ' + data + '</h1><input type = "text" id = "message">\
         <button type = "button" id= "messageBtn" name = "'+ data + '" onclick = "sendMessage()">Send Message</button><button type="button" name="button1" onclick= "leaveLobby()">Leave Lobby</button>\
         <div id = "message-container"></div>';



    });

    //Function for joining lobby. 
    function joinLobby() {
        //Takes the lobby ID from the message text box
        var lobbyToJoin = document.getElementById('message').value;
       
        socket.emit('joinLobby', { user: user, lobby: lobbyToJoin  });
       


    }

    function leaveLobby() {
        var lobbytoLeave = document.getElementById('messageBtn');
        socket.emit('lobbyLeave', { user: user, lobby: lobbytoLeave });
        lobbyPage();
    }
</script>

<body>
    <div id="error-container"></div>
    <input id="name" type="text" name="name" value=""
           placeholder="Enter your name!">
    <button type="button" name="button" onclick="setUsername()">
        Enter Username
    </button>
    
</body>
</html>